<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#4d1e90"><meta name="author" content="会飞的土豆"><meta name="copyright" content="会飞的土豆"><meta name="generator" content="Hexo 6.2.0"><meta name="theme" content="hexo-theme-yun"><title>jest测试框架搭建和简单使用 | 土豆子的躺平日常</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.3.3/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/png" href="/images/avatar.jpg"><link rel="mask-icon" href="/images/avatar.jpg" color="#4d1e90"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"flynna.github.io","root":"/","title":"相信土豆真的会飞","version":"1.10.4","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"local_search":{"path":"/search.xml"},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"fireworks":{"colors":null},"vendors":{"darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><link rel="stylesheet" href="/font/iconfont.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js"></script><script src="/font/iconfont.js"></script><meta name="description" content="了解测试用例和单元测试 测试用例：是为某个特殊目标而编制的一组测试输入、执行条件以及预期结果，测试是否满足特定需求；  单元测试：(是测试的级别)。unit testing 针对某一个功能的[最小部分(单元)]测试，比如(函数？类？)的执行结果是否符合预期。  不同的企业可能对不同测试级别有不同的称谓，比如单元测试、增量测试、集成测试、回归测试、冒烟测试….. 谷歌对此创立了自己的命名方式：小型测">
<meta property="og:type" content="article">
<meta property="og:title" content="jest测试框架搭建和简单使用">
<meta property="og:url" content="https://flynna.github.io/engineering/jest/index.html">
<meta property="og:site_name" content="土豆子的躺平日常">
<meta property="og:description" content="了解测试用例和单元测试 测试用例：是为某个特殊目标而编制的一组测试输入、执行条件以及预期结果，测试是否满足特定需求；  单元测试：(是测试的级别)。unit testing 针对某一个功能的[最小部分(单元)]测试，比如(函数？类？)的执行结果是否符合预期。  不同的企业可能对不同测试级别有不同的称谓，比如单元测试、增量测试、集成测试、回归测试、冒烟测试….. 谷歌对此创立了自己的命名方式：小型测">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-07-19T13:23:31.000Z">
<meta property="article:modified_time" content="2022-07-19T13:23:31.000Z">
<meta property="article:author" content="会飞的土豆">
<meta property="article:tag" content="jest">
<meta name="twitter:card" content="summary"><script>(function() {
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="会飞的土豆"><img width="96" loading="lazy" src="/images/avatar.jpg" alt="会飞的土豆"><span class="site-author-status" title="Looking for dawn.">🍋</span></a><div class="site-author-name"><a href="/about/">会飞的土豆</a></div><span class="site-name">土豆子的躺平日常</span><sub class="site-subtitle">just do it</sub><div class="site-description">星光不问赶路人, 岁月不负有心人</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">55</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">38</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">75</span></a></div><a class="site-state-item hty-icon-button" href="/about/#comment" title="留言板"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:clipboard-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=2274105875&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/flynna" title="GitHub" target="_blank" style="color:#181717"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="flynnzhl@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://weibo.com/flynna" title="微博" target="_blank" style="color:#E6162D"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-weibo-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=502374002" title="网易云音乐" target="_blank" style="color:#C10D0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.zhihu.com/people/flynn-zhl" title="知乎" target="_blank" style="color:#0084FF"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhihu-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/482340176" title="哔哩哔哩动画" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%E5%92%8C%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">1.</span> <span class="toc-text">了解测试用例和单元测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3%E5%BF%AB%E7%85%A7%E6%B5%8B%E8%AF%95"><span class="toc-number">2.</span> <span class="toc-text">了解快照测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jest-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">3.</span> <span class="toc-text">jest 环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-number">3.1.</span> <span class="toc-text">默认配置项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B"><span class="toc-number">4.</span> <span class="toc-text">测试用例简单示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E5%88%86Api%E5%AD%A6%E4%B9%A0"><span class="toc-number">5.</span> <span class="toc-text">部分Api学习</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A9jest-%E6%94%AF%E6%8C%81-esModule"><span class="toc-number">6.</span> <span class="toc-text">让jest 支持 esModule</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%B8%80%EF%BC%9A%E6%B7%BB%E5%8A%A0-babel-%E8%BD%AC%E8%AF%91"><span class="toc-number">6.1.</span> <span class="toc-text">方案一：添加 babel 转译</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%BA%8C%EF%BC%9A%E9%85%8D%E7%BD%AE-package-json"><span class="toc-number">6.2.</span> <span class="toc-text">方案二：配置 package.json</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-typescript"><span class="toc-number">7.</span> <span class="toc-text">测试 typescript</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%B8%80%EF%BC%9A%E4%BB%85%E7%BC%96%E8%AF%91%EF%BC%8C%E4%B8%8D%E5%81%9A%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%B5%8B"><span class="toc-number">7.1.</span> <span class="toc-text">方案一：仅编译，不做类型检测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%BA%8C%EF%BC%9A%E7%BC%96%E8%AF%91%E5%B9%B6%E5%AF%B9%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%B5%8B"><span class="toc-number">7.2.</span> <span class="toc-text">方案二：编译并对类型检测</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%BC%82%E6%AD%A5%E7%BB%93%E6%9E%9C"><span class="toc-number">8.</span> <span class="toc-text">测试异步结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%B8%80%EF%BC%9A%E6%8E%A5%E5%8F%97%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0-done"><span class="toc-number">8.1.</span> <span class="toc-text">方案一：接受一个参数 done</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%BA%8C%EF%BC%9Areturn-%E8%BF%94%E5%9B%9E%E4%B8%80%E4%B8%AA-promise-%E7%BB%93%E6%9E%9C"><span class="toc-number">8.2.</span> <span class="toc-text">方案二：return 返回一个 promise 结果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%B8%89%EF%BC%9Aasync-await-%E6%8E%A8%E8%8D%90"><span class="toc-number">8.3.</span> <span class="toc-text">方案三：async await (推荐)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0"><span class="toc-number">9.</span> <span class="toc-text">生命周期钩子函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%E7%9A%84%E5%88%86%E7%BB%84"><span class="toc-number">10.</span> <span class="toc-text">测试用例的分组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96-API"><span class="toc-number">11.</span> <span class="toc-text">其他 API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-Vue-%E7%BB%84%E4%BB%B6"><span class="toc-number">12.</span> <span class="toc-text">测试 Vue 组件</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#4d1e90;"><link itemprop="mainEntityOfPage" href="https://flynna.github.io/engineering/jest/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="会飞的土豆"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="土豆子的躺平日常"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">jest测试框架搭建和简单使用</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="创建时间：2022-07-19 21:23:31" itemprop="dateCreated datePublished" datetime="2022-07-19T21:23:31+08:00">2022-07-19</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="本文字数"><span class="icon iconify" data-icon="ri:file-word-line"></span></span> <span title="本文字数">3.5k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读时长"><span class="icon iconify" data-icon="ri:timer-line"></span></span> <span title="阅读时长">15m</span></span></span><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/" style="--text-color:#F4DF4F" itemprop="url" rel="index"><span itemprop="text">前端工程化</span></a></span> > <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">单元测试</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/jest/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">jest</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h3 id="了解测试用例和单元测试"><a href="#了解测试用例和单元测试" class="headerlink" title="了解测试用例和单元测试"></a>了解测试用例和单元测试</h3><ul>
<li><p>测试用例：是为某个特殊目标而编制的一组测试输入、执行条件以及预期结果，测试是否满足特定需求；</p>
</li>
<li><p>单元测试：(是测试的级别)。unit testing 针对某一个功能的[最小部分(单元)]测试，比如(函数？类？)的执行结果是否符合预期。</p>
<blockquote>
<p>不同的企业可能对不同测试级别有不同的称谓，比如单元测试、增量测试、集成测试、回归测试、冒烟测试….. 谷歌对此创立了自己的命名方式：小型测试(具体到某个函数？)、中型测试(多个模块之间交互)、大型测试(端对端？系统整体验证)。</p>
</blockquote>
</li>
</ul>
<span id="more"></span>

<h3 id="了解快照测试"><a href="#了解快照测试" class="headerlink" title="了解快照测试"></a>了解快照测试</h3><blockquote>
<p>快照测试：例如对 vue 的测试，就是将 vue 渲染的 dom 结果序列化成 string，然后存入到 snapshot 文件夹下，后缀为.snap, 如果是首次则会新建，不是首次，那么以后的每次测试，如果是基于快照的，就会那快照的内容与当前执行的内容做比较，如果不同，则抛出异常告知变更项；<br>快照测试一般用于代码趋于稳定的版本，提升测试的稳定性和速度；</p>
</blockquote>
<h3 id="jest-环境搭建"><a href="#jest-环境搭建" class="headerlink" title="jest 环境搭建"></a>jest 环境搭建</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> jest-project
<span class="token builtin class-name">cd</span> jest-project/

<span class="token comment"># 项目初始化及依赖安装</span>
<span class="token function">npm</span> init -y
<span class="token comment"># jest 安装.. 注意版本号 28版本以后 需要另外再安装 jest-environment-jsdom</span>
<span class="token function">yarn</span> <span class="token function">add</span> jest@24.8.0 --dev
<span class="token comment"># scripts 添加指令</span>
test: <span class="token string">"jest"</span>
<span class="token comment"># test 文件改动 自动执行 jest</span>
<span class="token string">"test:debug"</span><span class="token builtin class-name">:</span> <span class="token string">"jest --watchAll"</span>

<span class="token comment"># 初始化 jest 配置文件 (npx xx 可以理解为寻址执行(优先找$path,再从node_modules查找)，如果xx存在，那么就执行这个exe， 不存在则安装再执行)</span>
<span class="token comment"># 执行结束会根据选项,生成对应配置文件 jest.config.js|ts</span>
npx jest --init
√ Would you like to use Typescript <span class="token keyword">for</span> the configuration file? <span class="token punctuation">..</span>. no
√ Choose the <span class="token builtin class-name">test</span> environment that will be used <span class="token keyword">for</span> testing » jsdom <span class="token punctuation">(</span>browser-like<span class="token punctuation">)</span>
√ Do you want Jest to <span class="token function">add</span> coverage reports? <span class="token punctuation">..</span>. <span class="token function">yes</span>
√ Which provider should be used to instrument code <span class="token keyword">for</span> coverage? » babel
√ Automatically <span class="token function">clear</span> mock calls and instances between every test? <span class="token punctuation">..</span>. <span class="token function">yes</span>

<span class="token comment"># 生成覆盖率检测文件</span>
npx jest --coverage or 添加执行命令 <span class="token function">yarn</span> coverage: <span class="token string">"jest --coverage"</span></code></pre>

<h4 id="默认配置项"><a href="#默认配置项" class="headerlink" title="默认配置项"></a>默认配置项</h4><p><a target="_blank" rel="noopener" href="https://github.com/vuejs/vue-cli/blob/dev/packages/%40vue/cli-plugin-unit-jest/presets/default/jest-preset.js"><code>default-jest-config</code></a></p>
<h3 id="测试用例简单示例"><a href="#测试用例简单示例" class="headerlink" title="测试用例简单示例"></a>测试用例简单示例</h3><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 添加测试的主文件 例如：feature1.js</span>
<span class="token comment">// 测试对应测试文件 feature1.test.js</span>

<span class="token comment">// 注意：jest 测试文件不需要具体指明文件名称 而是通过 test.js 标识</span>

<span class="token comment">// feature1.js</span>
<span class="token keyword">function</span> <span class="token function">myFn1TestAdd</span><span class="token punctuation">(</span><span class="token parameter">arg0<span class="token punctuation">,</span> arg1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> arg0 <span class="token operator">+</span> arg1<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">myFn2TestLogic</span><span class="token punctuation">(</span><span class="token parameter">arg0<span class="token punctuation">,</span> arg1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> arg0 <span class="token operator">&lt;</span> arg1<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span> myFn1TestAdd<span class="token punctuation">,</span> myFn2TestLogic <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// feature1.test.js</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> myFn1TestAdd<span class="token punctuation">,</span> myFn2TestLogic <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./feature1.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test number summation'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">myFn1TestAdd</span><span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'compare number'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">myFn2TestLogic</span><span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">myFn2TestLogic</span><span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p><code>理解：test(用例描述，执行回调) 创建一个测试用例， expect 预期(实际值：这里是测试的函数，那么即为函数的返回值) toBe[匹配器 通过 object.js(绝对比较，类似 === 效果) 比较](期望值)，not 可以理解为取反</code></p>
<h3 id="部分Api学习"><a href="#部分Api学习" class="headerlink" title="部分Api学习"></a>部分<code>Api</code>学习</h3><ul>
<li>自定义 matchers</li>
</ul>
<p>​ <code>等值判断</code></p>
<ul>
<li><p><code>toEqual</code> 匹配器: 递归比较对象属性实例，和 <code>toBe</code>匹配器的区别在于 <code>toBe</code> 类似 <code>===</code> 的方式进行绝对匹配，实际运用中 <code>toEqual</code>更适合对比引用类型数据的预期输出；</p>
</li>
<li><p><code>toStrictEqual</code>匹配器：严格比较，例如：<code>[, , 1] 和 [undefined, undefined, 1]</code></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// expect(&#123; a: 1, b: 'aa', c: false &#125;).toEqual(&#123; a: 1, b: 'aa' &#125;); // false</span>
<span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">'aa'</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">'aa'</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">'aa'</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toStrictEqual</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">'aa'</span><span class="token punctuation">,</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">'aa'</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">__proto__</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">q</span><span class="token operator">:</span> <span class="token string">'eq'</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">'aa'</span><span class="token punctuation">,</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">'aa'</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">__proto__</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">q</span><span class="token operator">:</span> <span class="token string">'eq'</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toStrictEqual</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">'aa'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token comment">// expect([, , 1]).toStrictEqual([undefined, undefined, 1]); // false</span></code></pre>
</li>
<li><p><code>toBeCloseTo(number, numDigits?)</code> 匹配器： 解决<code>JavaScript</code> 浮点数相等比较问题</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test toBeCloseTo'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCloseTo</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li>
</ul>
<p>​ <code>数字大小比较</code></p>
<ul>
<li><p><code>toBeGreaterThan</code> <code>toBeGreaterThanOrEqual</code> <code>toBeLessThan</code> <code>toBeLessThanOrEqual</code> (参数均为<code>number | bigint</code>)匹配器: 是否大于、大于等于、小于、小于等于值；</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test toBeLessThan toBeGreaterThan'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeLessThan</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeGreaterThan</span><span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li>
</ul>
<p>​ <code>类型判断</code></p>
<ul>
<li><p><code>toBeNull</code> <code>toBeUndefined</code> <code>toBeDefined </code> 匹配器(无参数)：判断这个值是否为 <code>null、undefined、不为undefined</code>；</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test undefined'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> a<span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeUndefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

  a <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeUndefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

  a <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeUndefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</li>
<li><p><code>toBeTruthy</code> <code>toBeFalsy</code> <code>toBeNaN</code> 匹配器(无参数)：判断一个值经过隐式转换后为 <code>true、false</code>(类似 1，’test’ 等等 <code>toBeTruthy()</code> 则达到预期)、判断一个值是否为 <code>NaN</code>(和<code>toBeTruthy/toBeFalsy</code> 不同的是，这里为显示比较);</p>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test NaN'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token string">'11'</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeNaN</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>

  n <span class="token operator">=</span> <span class="token string">'11ds'</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeNaN</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>

  n <span class="token operator">=</span> <span class="token number">NaN</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeNaN</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<ul>
<li><code>toBeInstanceOf(class)</code>匹配器：判断是否为某个类的实例对象；</li>
</ul>
<p>​ <code>判断是否包含某个值</code></p>
<ul>
<li><p><code>toMatch(regexp | string) </code>匹配器：判断字符串是否能够根据<code>match</code>参数提取片段(简言之，<code>match</code> 为 <code>regexp</code> 时，类似<code>reg.test(str)</code>, 类型为 <code>string</code> 时类似 <code>str.includes(match) or str.indexOf(match) &gt; -1</code>);</p>
</li>
<li><p><code>toMatchObject(obj)</code> 匹配器：判断 obj 是否为某个对象的子集</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span> be<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> kit<span class="token operator">:</span> <span class="token punctuation">&#123;</span> am<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'oven'</span><span class="token punctuation">,</span> <span class="token string">'stove'</span><span class="token punctuation">,</span> <span class="token string">'washer'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> area<span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  kit<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    am<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'oven'</span><span class="token punctuation">,</span> <span class="token string">'stove'</span><span class="token punctuation">,</span> <span class="token string">'washer'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'the  has my desired features'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchObject</span><span class="token punctuation">(</span>ob<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// pase</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</li>
<li><p><code>toContain(item)</code> 匹配器：判断数组是否包含了某个 <code>item</code>,类似 <code>arr.includes(&#39;xx&#39;)</code>;</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test toContain'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'aa'</span><span class="token punctuation">,</span> <span class="token string">'bb'</span><span class="token punctuation">,</span> <span class="token string">'cc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">'aa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li>
</ul>
<p>​ <code>判断是否抛出异常</code></p>
<ul>
<li><p><code>toThrow()</code> 匹配器：判断<code>expect</code>传入值执行过程中发生异常; 注意 <code>throw 抛出的异常值 要同 toThrow 参数一致</code>。此时 <code>expect 传入的不再是具体的值，而是可执行回调</code></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test toThrow'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">fn1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'aa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">fn2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'aa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">fn3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>fn1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toThrow</span><span class="token punctuation">(</span><span class="token string">'aa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
  <span class="token comment">// expect(fn2).toThrow('aa'); // false</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>fn3<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toThrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
  <span class="token comment">// expect(fn3).toThrow('aa'); // false</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li>
</ul>
<h3 id="让jest-支持-esModule"><a href="#让jest-支持-esModule" class="headerlink" title="让jest 支持 esModule"></a>让<code>jest</code> 支持 <code>esModule</code></h3><h4 id="方案一：添加-babel-转译"><a href="#方案一：添加-babel-转译" class="headerlink" title="方案一：添加 babel 转译"></a>方案一：添加 <code>babel</code> 转译</h4><p>​ <code>jest 运行在 node 环境中，遵循 commonJs 规范，无法识别 EsModule 类似 export/import ... form ...模块导入导出，因此添加 babel 实现转译，将 EsModule 转换为 commonJs 的导入导出规范；</code></p>
<ul>
<li><p><code>@babel/core@7.4.5</code> 指定所有的转译都是用本地配置文件 <code>.babelrc or package.json</code>；</p>
</li>
<li><p><code>@babel/preset-env@7.4.5</code> 转换器核心，用作语法转换编译；</p>
<blockquote>
<p>yarn add @babel&#x2F;<a href="mailto:&#x63;&#111;&#x72;&#101;&#x40;&#x37;&#x2e;&#x34;&#x2e;&#53;">&#x63;&#111;&#x72;&#101;&#x40;&#x37;&#x2e;&#x34;&#x2e;&#53;</a> @babel&#x2F;<a href="mailto:&#112;&#x72;&#101;&#x73;&#101;&#116;&#45;&#101;&#110;&#x76;&#x40;&#x37;&#x2e;&#52;&#x2e;&#x35;">&#112;&#x72;&#101;&#x73;&#101;&#116;&#45;&#101;&#110;&#x76;&#x40;&#x37;&#x2e;&#52;&#x2e;&#x35;</a> –dev</p>
</blockquote>
</li>
<li><p><code>yarn test</code> 执行 <code>jest</code> 前，<code>jest 的 babel-jest</code> 组件会优先检测是否安装了 <code>babel</code>，检测 <code>.babelrc</code> 配置文件是否存在，然后再根据 <code>babel</code>转译后的结果执行<code>test</code></p>
</li>
<li><p>添加 <code>.babelrc</code> 配置文件，指定预设规则；<code>对象：presets 为[&#39;presetName&#39;, options: any][]类型，每个 item 为一个预设</code>，预设：就是提供一个预定的配置项，然后与当前配置做合并；</p>
<pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"targets"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"node"</span><span class="token operator">:</span> <span class="token string">"current"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ul>
<h4 id="方案二：配置-package-json"><a href="#方案二：配置-package-json" class="headerlink" title="方案二：配置 package.json"></a>方案二：配置 <code>package.json</code></h4><ul>
<li><p>将 <code>package.json</code> 的 <code>type</code> 字段设置为 <code>module</code></p>
</li>
<li><p>每次执行 <code>jest</code> 指定环境变量</p>
<blockquote>
<p>&#x2F;&#x2F; package.json</p>
<p>{</p>
<p>&#x2F;&#x2F; …,</p>
<p>“type”: “module”,</p>
<p>“scripts”: {</p>
<p>​ <code>&quot;test&quot;: &quot;NODE_OPTIONS=--experimental-vm-modules jest&quot;</code></p>
<p>}</p>
<p>}</p>
</blockquote>
</li>
</ul>
<h3 id="测试-typescript"><a href="#测试-typescript" class="headerlink" title="测试 typescript"></a>测试 <code>typescript</code></h3><h4 id="方案一：仅编译，不做类型检测"><a href="#方案一：仅编译，不做类型检测" class="headerlink" title="方案一：仅编译，不做类型检测"></a>方案一：仅编译，不做类型检测</h4><p><code>通过 @babel/preset-typescript 预设，完成 typescript 的转译</code></p>
<blockquote>
<p>yarn add @babel&#x2F;preset-typescript –dev</p>
<p>&#x2F;&#x2F; 配置 .babelrc 转换器规则</p>
<p>{ presets: [ [‘@babel&#x2F;preset-typescript’] ] }</p>
</blockquote>
<h4 id="方案二：编译并对类型检测"><a href="#方案二：编译并对类型检测" class="headerlink" title="方案二：编译并对类型检测"></a>方案二：编译并对类型检测</h4><p><code>普通的 javascript 测试，使用内置的 babel-jest 组件。那么为 typescript 编写测试用例，则需要安装 ts-jest 组件；与此同时，安装 jest 的类型依赖，用于 .test.ts 中类型的注入。</code></p>
<blockquote>
<p>&#x2F;&#x2F; 建议 @types&#x2F;jest 版本同 jest 主次版本一致</p>
<p>yarn add ts-jest @types&#x2F;jest –dev</p>
<p>&#x2F;&#x2F; 配置 <code>jest.config.js</code> , 添加 preset: <code>&#39;ts-jest&#39;</code> 预设配置：即为预配置项。由 <code>ts-jest</code> 提供配置项，然后与当前配置做合并，这也是为什么加了预设过后，当前配置文件就不需要再向 <code>moduleFileExtensions</code> 内添加 ts 后缀识别，也不需要添加<code> transform &#123;&#39;^.+\\.tsx?$&#39;: tsJest&#125;</code>；告诉 <code>jest, .tsx 文件通过 require.resolve(&#39;ts-jest&#39;) 编译处理</code></p>
<p><code>&#123; ...otherOptions, preset: &#39;ts-jest&#39; &#125;</code></p>
</blockquote>
<h3 id="测试异步结果"><a href="#测试异步结果" class="headerlink" title="测试异步结果"></a>测试异步结果</h3><p><code>asyncFuntion.ts</code></p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">myRequestFn1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> rej<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">res</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> success<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>

<h4 id="方案一：接受一个参数-done"><a href="#方案一：接受一个参数-done" class="headerlink" title="方案一：接受一个参数 done"></a>方案一：接受一个参数 <code>done</code></h4><p><code>不管 done 在 test 回调函数内是否有被使用，整个回调都会被判定为异步函数，需要等待 done() 结束执行。有点类似 promise.resolve 结束 promise。等待超时后结果为 false</code></p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 直接在回调内的 promise.then 内写的语句不会被 test 检测，无关 equal 的值，结果都是 pass</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test Done'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">myRequestFn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> success<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 等待超时，结果异常</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test Done'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">myRequestFn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> success<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 正常执行</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test Done'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">myRequestFn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> success<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
    <span class="token comment">// expect(data).toEqual(&#123; success: false &#125;); // false</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<h4 id="方案二：return-返回一个-promise-结果"><a href="#方案二：return-返回一个-promise-结果" class="headerlink" title="方案二：return 返回一个 promise 结果"></a>方案二：<code>return</code> 返回一个 <code>promise</code> 结果</h4><p><code>返回一个 promise 结果，test 代码也可以被正常执行</code></p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test async return'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token function">myRequestFn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> success<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p><code>雷：当 return 返回的 promise 不包含错误时，catch 不会被执行，那么 .catch 内的 expec 始终都会被 pass；此时，通过添加 expect 断言来判断是否覆盖了 catch 测试语句</code></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test promise.catch return'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  expect<span class="token punctuation">.</span><span class="token function">assertions</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 参数为 expect 的执行此时</span>

  <span class="token keyword">return</span> <span class="token function">myRequestFn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeUndefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<h4 id="方案三：async-await-推荐"><a href="#方案三：async-await-推荐" class="headerlink" title="方案三：async await (推荐)"></a>方案三：<code>async await</code> (推荐)</h4><pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test async await'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">myRequestFn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// expect(res).toBeUndefined(); // failed</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> success<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// pass</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<h3 id="生命周期钩子函数"><a href="#生命周期钩子函数" class="headerlink" title="生命周期钩子函数"></a>生命周期钩子函数</h3><ul>
<li><p><code>beforeAll</code> <code>beforeEach</code> <code>afterEach</code> <code>afterAll</code> ：所有测试用例开始之前执行、每个测试用例开始之前执行、每个测试用例结束之后执行、所有测试用例结束之后执行。</p>
</li>
<li><p>作用域:</p>
<blockquote>
<p>钩子函数在父级分组可作用于子级，类似继承</p>
<p>钩子函数同级分组作用域互不干扰，各起作用</p>
<p>先执行外部的钩子函数，再执行内部的钩子函数</p>
</blockquote>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 分组和钩子函数理解</span>
<span class="token comment">// 父级分组</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a</span>
  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// b 这里父级的钩子函数会作用于子分组, 比如 beforeEach 在子分组的每个 test 执行之前会被触发</span>

  <span class="token comment">// 子分组</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'test a'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// c</span>
    <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// d</span>

    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test a.a'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// e</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test a.b'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// f</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'test b'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// g</span>
    <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// h</span>

    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test b.a'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// i</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test b.b'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// j</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// a -> c -> b -> d -> e -> b -> d -> f -> g -> b -> h -> i -> b -> h -> j</span></code></pre>

<p><code>简言之，同级从上到下执行，只有执行到该子级后，该子级的周期钩子函数才会被触发，例如 beforeALL；然后当该及的 beforeALL 钩子执行后，开始从最外向内级依次执行 beforeEach ,再从上到下执行该级的 test 用例。注意：after 钩子与 before 相反，after 钩子是由内向外级依次执行。 类似 vue 的父子组件的生命周期执行顺序</code>；</p>
</li>
</ul>
<h3 id="测试用例的分组"><a href="#测试用例的分组" class="headerlink" title="测试用例的分组"></a>测试用例的分组</h3><p>​ <code>当测试用例足够多时，过量的测试用例 不方便管理及查看。此时使用 describe(name, fn) 对测试用例分组；注意：分组后还可以进行子分组，最外层可以理解为一个 describe</code>。</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 原:</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test a.a'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test a.b'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test b.a'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test b.b'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 分组后：(将原有的 test 用例拷贝到 describe 回调内即可完成分组)</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'test a'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test a.a'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test a.b'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'test b'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test b.a'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test b.b'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<h3 id="其他-API"><a href="#其他-API" class="headerlink" title="其他 API"></a>其他 <code>API</code></h3><ul>
<li><code>test.only(name, fn)</code> 当存在 <code>test.only</code> 时，其他的测试用例会被 skipped 跳过，只执行当前的测试用例，通常用于 <code>debug</code></li>
</ul>
<h3 id="测试-Vue-组件"><a href="#测试-Vue-组件" class="headerlink" title="测试 Vue 组件"></a>测试 <code>Vue</code> 组件</h3><p><code>配合 @vue/test-utils 提供的 api，完成 vue 组件的 TDD(单元) 测试</code></p>
<ul>
<li><p>在项目中，能够被正确识别的测试文件，通常被指定在 <code>**/tests/unit/**/*.spec.[jt]s?(x) or **/__tests__/*.[jt]s?(x) </code></p>
</li>
<li><p><code>it</code>(断言)，<code>test</code>测试，类似 it。</p>
</li>
<li><p>通过 <code>@vue/test-utils 提供的 mount or shadowMount 函数来挂载并渲染 vue</code>。</p>
</li>
<li><p>由于 <code>jest</code> 默认配置包含了对 <code>@</code> 符号路径的映射，所以可以直接使用。</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// xx.spec.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> mount<span class="token punctuation">,</span> shadowMount <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token constant">XX</span> <span class="token keyword">from</span> <span class="token string">'@/xxx/Xx.vue'</span><span class="token punctuation">;</span> <span class="token comment">// 由于配置了引用后缀，这里可以不写 .vue</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'测试一个 XX 组件功能'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'测试 A 函数'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shadowMount</span><span class="token punctuation">(</span><span class="token constant">XX</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 断言 add TDD</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatch</span><span class="token punctuation">(</span><span class="token string">'测试'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</li>
<li><p><code>shadowMount 和 mount</code> 的区别：<a target="_blank" rel="noopener" href="https://github.com/holylovelqq/vue-unit-test-with-jest/issues/4">参考</a></p>
<p><code>渲染区别：</code></p>
<pre class="language-none"><code class="language-none">mount：踏踏实实的渲染，会将被测试组件中使用到的子子孙孙组件完全渲染。最终结果内肯定不存在自定义组件名作为标签名，包括插件提供的V-btn之类的dom结构，全部不存在，彻底渲染到&lt;div&gt;&lt;span&gt;&lt;p&gt;之类

shallowMount：浅渲染，与mount相反，既不会渲染子组件，更不用提孙子辈的组件，仅限测试组件本身。子组件会原原本本的显示子组件的存根，当使用stubs的时候，子组件存根是可以自定义显示内容的，如果未自定义，将会显示子组件名-stub的标签名，如&lt;my-componet-stub&gt;&lt;&#x2F;my-componet-stub&gt;</code></pre>

<p><code>场景</code>：</p>
<pre class="language-none"><code class="language-none">mount：多数情况出现在snapshot中使用，而且也只是部分snapshot中必须使用mount。下面将说明何种情况：当被测试组件内包含子组件，且子组件的dom结构通过slot在被测试组件内定义的时候，必须使用mount来测试snapshot。

hallowMount：所有必须使用mount的情况以外都使用shallowMount，使用mount将更大的消耗时间和性能，
----&gt; 实际上所有测试都可以不使用mount，但是鉴于测试的复杂性，有可能会出现用shallowMount怎么也报错的情况，但是改成mount就能测试通过</code></pre>

<p><code>基本准则：所有使用 shallowMount 的地方都可以用 mount 替换，但是但凡能使用 shallowMount 的地方坚决不用 mount；</code></p>
</li>
</ul>
</div></section><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>会飞的土豆</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://flynna.github.io/engineering/jest/" title="jest测试框架搭建和简单使用">https://flynna.github.io/engineering/jest/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> 许可协议。</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/share/javascript-event/" rel="prev" title="javascript中的事件组成、分类、绑定与监听"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">javascript中的事件组成、分类、绑定与监听</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/share/javascript-scope/" rel="next" title="javascript 作用域理解"><span class="post-nav-text">javascript 作用域理解</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>如果您有任何关于博客内容的相关讨论，欢迎前往 <a href="https://github.com/flynna/flynna.github.io/discussions" target="_blank">GitHub Discussions</a> 与我交流。</span><br></div><style>.utterances {
  max-width: 100%;
}</style><script src="https://giscus.app/client.js" data-repo="flynna/flynna.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkzNDE0MDgyNjE=" data-category="Announcements" data-category-id="DIC_kwDOFFl6Bc4CQHuO" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-theme="light" crossorigin="anonymous" async></script></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2022 – 2023 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> 会飞的土豆</span></div><div class="live-time"><span>本博客已萌萌哒地运行</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2022-07-07T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = ` ${passDay} 天 ${passHour} 小时 ${passMinute} 分 ${passSecond} 秒`;
}
blog_live_time();
</script></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#4d1e90" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:search-line"></span></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="https://fastly.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js"></script><script src="/js/search/local-search.js" defer type="module"></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><span class="icon iconify" data-icon="ri:close-line"></span></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div class="search-result-container"></div></div><script>function initMourn() {
  const date = new Date();
  const today = (date.getMonth() + 1) + "-" + date.getDate()
  const mourn_days = ["4-4","9-18"]
  if (mourn_days.includes(today)) {
    document.documentElement.style.filter = "grayscale(1)";
  }
}
initMourn();</script><script src="https://cdn.jsdelivr.net/npm/live2d-widget@^3.1.3/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"https://cdn.jsdelivr.net/npm/live2d-widget-model-koharu@1.0.5/assets/koharu.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body></html>